# ğŸ—ï¸ Architecture Overview

## System Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      React Application                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    App.tsx                               â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚         <AuthProvider>                           â”‚   â”‚   â”‚
â”‚  â”‚  â”‚         [Manages global auth state]              â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚         Routes                             â”‚  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚                                             â”‚  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  /auth â”€â”€â”€â”€â”€â”€â†’ Auth Page                    â”‚  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚                (Login/Signup Form)          â”‚  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚                                             â”‚  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  / â”€â”€â”€â”€â†’ <ProtectedRoute>                   â”‚  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚           â†“                                 â”‚  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚          Index Page                         â”‚  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚                                             â”‚  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  /profile â”€â”€â†’ <ProtectedRoute>              â”‚  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚               â†“                             â”‚  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚              Profile Page                   â”‚  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚                                             â”‚  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                   â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“                                      â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ AuthContext    â”‚          â”‚   UI Components          â”‚
    â”‚ (Manages:      â”‚          â”‚  â”œâ”€ Input fields         â”‚
    â”‚  - user        â”‚          â”‚  â”œâ”€ Buttons              â”‚
    â”‚  - profile     â”‚          â”‚  â”œâ”€ Error messages       â”‚
    â”‚  - session     â”‚          â”‚  â””â”€ Toast notifications  â”‚
    â”‚  - loading)    â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         Supabase Client (@supabase/supabase-js)        â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚ Authentication Service                           â”‚  â”‚
    â”‚  â”‚  - signUp(email, password, fullName)             â”‚  â”‚
    â”‚  â”‚  - signInWithPassword(email, password)           â”‚  â”‚
    â”‚  â”‚  - signOut()                                     â”‚  â”‚
    â”‚  â”‚  - getSession()                                  â”‚  â”‚
    â”‚  â”‚  - onAuthStateChange()                           â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚ Database Service (PostgreSQL Queries)            â”‚  â”‚
    â”‚  â”‚  - select() - fetch profiles                     â”‚  â”‚
    â”‚  â”‚  - update() - modify profiles                    â”‚  â”‚
    â”‚  â”‚  - insert() - create profiles                    â”‚  â”‚
    â”‚  â”‚  - delete() - remove profiles                    â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“                                    â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Supabase Backend    â”‚    â”‚   Supabase PostgreSQL DB    â”‚
    â”‚  (Cloud Functions,   â”‚    â”‚                             â”‚
    â”‚   Authentication,    â”‚    â”‚   Tables:                   â”‚
    â”‚   Middleware)        â”‚    â”‚   â”œâ”€ auth.users             â”‚
    â”‚                      â”‚    â”‚   â”‚  (id, email,            â”‚
    â”‚                      â”‚    â”‚   â”‚   password_hash,        â”‚
    â”‚                      â”‚    â”‚   â”‚   created_at)            â”‚
    â”‚                      â”‚    â”‚   â”‚                          â”‚
    â”‚   Triggers:          â”‚    â”‚   â””â”€ public.profiles        â”‚
    â”‚   â”œâ”€ on_auth_user_   â”‚    â”‚      (id, full_name,        â”‚
    â”‚   â”‚  created         â”‚    â”‚       phone, city,          â”‚
    â”‚   â”‚  (Auto creates   â”‚    â”‚       avatar_url,           â”‚
    â”‚   â”‚   profiles)      â”‚    â”‚       created_at,           â”‚
    â”‚   â”‚                  â”‚    â”‚       updated_at)           â”‚
    â”‚   â””â”€ update_        â”‚    â”‚                             â”‚
    â”‚      _updated_at    â”‚    â”‚   RLS Policies:             â”‚
    â”‚      (Timestamp)    â”‚    â”‚   â”œâ”€ Viewable by            â”‚
    â”‚                      â”‚    â”‚   â”‚  authenticated users    â”‚
    â”‚                      â”‚    â”‚   â”œâ”€ Users can update      â”‚
    â”‚                      â”‚    â”‚   â”‚  own profiles           â”‚
    â”‚                      â”‚    â”‚   â””â”€ Users can insert      â”‚
    â”‚                      â”‚    â”‚      own profiles           â”‚
    â”‚                      â”‚    â”‚                             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow Diagram

### User Sign Up Flow
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Form  â”‚
â”‚ (Auth Page) â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ onClick("Create Account")
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AuthContext.signUp()         â”‚
â”‚ - Validate form              â”‚
â”‚ - email, password, fullName  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Call Supabase Auth
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Supabase Authentication Service          â”‚
â”‚ - Hash password                          â”‚
â”‚ - Create user in auth.users              â”‚
â”‚ - Store metadata (full_name)             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Trigger: on_auth_user_created
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Database Trigger                         â”‚
â”‚ - Auto-create profile row                â”‚
â”‚ - Set full_name from metadata            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AuthContext.onAuthStateChange()          â”‚
â”‚ - Fetch profile from profiles table      â”‚
â”‚ - Set user, profile, session state       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Navigation                               â”‚
â”‚ - Redirect to home page (/)              â”‚
â”‚ - Show success toast                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### User Login Flow
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Form  â”‚
â”‚ (Auth Page) â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ onClick("Log In")
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AuthContext.signIn()         â”‚
â”‚ - Validate email & password  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Call Supabase Auth
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Supabase Authentication Service          â”‚
â”‚ - Verify credentials                     â”‚
â”‚ - Create session                         â”‚
â”‚ - Return JWT token                       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AuthContext.onAuthStateChange()          â”‚
â”‚ - Fetch profile from profiles table      â”‚
â”‚ - Set user, profile, session state       â”‚
â”‚ - Store session in localStorage          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ProtectedRoute Component                 â”‚
â”‚ - Check if user exists (loading = false) â”‚
â”‚ - Render protected component             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Navigation                               â”‚
â”‚ - Redirect to home page (/)              â”‚
â”‚ - Show success toast                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Protected Route Access Flow
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User navigates to /profile              â”‚
â”‚ (ProtectedRoute wraps Profile page)     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ProtectedRoute checks:                   â”‚
â”‚ - if (loading) â†’ show spinner            â”‚
â”‚ - if (!user) â†’ redirect to /auth         â”‚
â”‚ - if (user) â†’ render <Profile />         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€ NO SESSION
       â”‚  â†“
       â”‚  Redirect to /auth
       â”‚
       â”œâ”€ LOADING
       â”‚  â†“
       â”‚  Show Loading Spinner
       â”‚
       â””â”€ HAS SESSION
          â†“
          Render Profile Page
          â†“
          useAuth() hook available
          â†“
          Access user, profile, signOut, etc.
```

---

## State Management Diagram

### AuthContext State Tree
```
AuthContext
â”‚
â”œâ”€ user: User | null
â”‚  â”œâ”€ id: string (UUID)
â”‚  â”œâ”€ email: string
â”‚  â”œâ”€ user_metadata: { full_name: string }
â”‚  â”œâ”€ app_metadata: { provider: string, ... }
â”‚  â””â”€ ...other Supabase User fields
â”‚
â”œâ”€ profile: UserProfile | null
â”‚  â”œâ”€ id: string (UUID)
â”‚  â”œâ”€ full_name: string | null
â”‚  â”œâ”€ phone: string | null
â”‚  â”œâ”€ city: string | null
â”‚  â”œâ”€ avatar_url: string | null
â”‚  â”œâ”€ created_at: string
â”‚  â””â”€ updated_at: string
â”‚
â”œâ”€ session: Session | null
â”‚  â”œâ”€ access_token: string
â”‚  â”œâ”€ refresh_token: string
â”‚  â””â”€ user: User
â”‚
â””â”€ loading: boolean

Functions:
â”œâ”€ signIn(email: string, password: string)
â”œâ”€ signUp(email: string, password: string, fullName: string)
â”œâ”€ signOut()
â””â”€ fetchUserProfile(userId: string)
```

---

## Component Relationship Diagram

```
App.tsx
â”‚
â”œâ”€ <AuthProvider>
â”‚  â”‚
â”‚  â”œâ”€ <BrowserRouter>
â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€ <Routes>
â”‚  â”‚     â”‚
â”‚  â”‚     â”œâ”€ /auth
â”‚  â”‚     â”‚  â””â”€ <Auth />
â”‚  â”‚     â”‚     â””â”€ useAuth()
â”‚  â”‚     â”‚        - signIn()
â”‚  â”‚     â”‚        - signUp()
â”‚  â”‚     â”‚
â”‚  â”‚     â”œâ”€ / (Protected)
â”‚  â”‚     â”‚  â””â”€ <ProtectedRoute>
â”‚  â”‚     â”‚     â””â”€ <Index />
â”‚  â”‚     â”‚        â””â”€ useAuth()
â”‚  â”‚     â”‚
â”‚  â”‚     â”œâ”€ /profile (Protected)
â”‚  â”‚     â”‚  â””â”€ <ProtectedRoute>
â”‚  â”‚     â”‚     â””â”€ <Profile />
â”‚  â”‚     â”‚        â”œâ”€ useAuth()
â”‚  â”‚     â”‚        â””â”€ profileService
â”‚  â”‚     â”‚
â”‚  â”‚     â””â”€ /wall, /directory, etc. (Protected)
â”‚  â”‚        â””â”€ <ProtectedRoute>
â”‚  â”‚
â”‚  â””â”€ <TooltipProvider>
â”‚     â”œâ”€ <Toaster />
â”‚     â””â”€ <Sonner />
â”‚
â””â”€ <QueryClientProvider>
   â””â”€ For server state management
```

---

## Service Layer Diagram

```
Services
â”‚
â”œâ”€ profileService.ts
â”‚  â”œâ”€ getProfile(userId)
â”‚  â”‚  â””â”€ supabase.from("profiles").select().eq("id", userId).single()
â”‚  â”‚
â”‚  â”œâ”€ updateProfile(userId, updates)
â”‚  â”‚  â””â”€ supabase.from("profiles").update(updates).eq("id", userId)
â”‚  â”‚
â”‚  â”œâ”€ updateProfileField(userId, field, value)
â”‚  â”‚  â””â”€ updateProfile(userId, { [field]: value })
â”‚  â”‚
â”‚  â”œâ”€ createProfile(userId, fullName)
â”‚  â”‚  â””â”€ supabase.from("profiles").insert({ id, full_name })
â”‚  â”‚
â”‚  â””â”€ profileExists(userId)
â”‚     â””â”€ supabase.from("profiles").select("id").eq("id", userId)
â”‚
â””â”€ Supabase Client (src/integrations/supabase/client.ts)
   â”œâ”€ supabase.auth.*
   â”‚  â”œâ”€ signUp()
   â”‚  â”œâ”€ signInWithPassword()
   â”‚  â”œâ”€ signOut()
   â”‚  â”œâ”€ getSession()
   â”‚  â””â”€ onAuthStateChange()
   â”‚
   â””â”€ supabase.from()
      â”œâ”€ .select()
      â”œâ”€ .insert()
      â”œâ”€ .update()
      â”œâ”€ .delete()
      â”œâ”€ .eq()
      â”œâ”€ .single()
      â””â”€ ... RLS enforced automatically
```

---

## Authentication Flow Sequence Diagram

### Signup Sequence
```
User                Auth Page         AuthContext      Supabase          Database
  â”‚                    â”‚                  â”‚               â”‚                â”‚
  â”œâ”€ "Create Account"â”€â”€â†’â”‚                  â”‚               â”‚                â”‚
  â”‚                    â”œâ”€ Form Validation  â”‚               â”‚                â”‚
  â”‚                    â”‚ - email valid?    â”‚               â”‚                â”‚
  â”‚                    â”‚ - password >= 6?  â”‚               â”‚                â”‚
  â”‚                    â”‚ - name >= 2 chars?â”‚               â”‚                â”‚
  â”‚                    â”œâ”€ signUp()â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚               â”‚                â”‚
  â”‚                    â”‚                  â”œâ”€ signUp()â”€â”€â”€â”€â†’â”‚                â”‚
  â”‚                    â”‚                  â”‚               â”œâ”€ Hash password  â”‚
  â”‚                    â”‚                  â”‚               â”œâ”€ Create user    â”‚
  â”‚                    â”‚                  â”‚               â”œâ”€ Save metadata  â”‚
  â”‚                    â”‚                  â”‚               â””â”€ Triggerâ”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
  â”‚                    â”‚                  â”‚               â”‚                 â”œâ”€ Create profile
  â”‚                    â”‚                  â”‚               â”‚                 â”œâ”€ Set full_name
  â”‚                    â”‚                  â”‚               â”‚                 â””â”€ Set timestamp
  â”‚                    â”‚                  â”‚â†â”€ onAuthStateChange()          â”‚
  â”‚                    â”‚                  â”œâ”€ Fetch profileâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
  â”‚                    â”‚                  â”‚â†â”€ Profile data                 â”‚
  â”‚                    â”‚                  â”‚ Set user, profile, session     â”‚
  â”‚                    â”‚â†â”€ Responseâ”€â”€â”€â”€â”€â”€  â”‚                               â”‚
  â”‚                    â”‚ Success toast    â”‚                               â”‚
  â”‚ Redirect to /      â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                               â”‚
  â”‚
```

### Login Sequence
```
User                Auth Page         AuthContext      Supabase          Database
  â”‚                    â”‚                  â”‚               â”‚                â”‚
  â”œâ”€ "Log In"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                  â”‚               â”‚                â”‚
  â”‚                    â”œâ”€ Form Validation  â”‚               â”‚                â”‚
  â”‚                    â”‚ - email valid?    â”‚               â”‚                â”‚
  â”‚                    â”‚ - password >= 6?  â”‚               â”‚                â”‚
  â”‚                    â”œâ”€ signIn()â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚               â”‚                â”‚
  â”‚                    â”‚                  â”œâ”€ signInWithPassword()â”€â”€â†’â”‚        â”‚
  â”‚                    â”‚                  â”‚               â”œâ”€ Verify email   â”‚
  â”‚                    â”‚                  â”‚               â”œâ”€ Verify pwd     â”‚
  â”‚                    â”‚                  â”‚               â”œâ”€ Create token   â”‚
  â”‚                    â”‚                  â”‚               â””â”€ Return session
  â”‚                    â”‚                  â”‚â†â”€ Session (with user & token)  â”‚
  â”‚                    â”‚                  â”‚ Set session, user              â”‚
  â”‚                    â”‚                  â”œâ”€ Fetch profileâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
  â”‚                    â”‚                  â”‚â†â”€ Profile data                 â”‚
  â”‚                    â”‚                  â”‚ Set profile state              â”‚
  â”‚                    â”‚â†â”€ Responseâ”€â”€â”€â”€â”€â”€  â”‚                               â”‚
  â”‚                    â”‚ Success toast    â”‚                               â”‚
  â”‚ Redirect to /      â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                               â”‚
  â”‚
```

---

## Session Persistence Diagram

```
Browser             AuthContext      LocalStorage      Supabase
  â”‚                    â”‚                  â”‚               â”‚
  â”‚ Initial Load       â”‚                  â”‚               â”‚
  â”œâ”€ Page Loadâ”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                  â”‚               â”‚
  â”‚                    â”œâ”€ Check localStorage              â”‚
  â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚               â”‚
  â”‚                    â”‚â†â”€ Session (if exists)          â”‚
  â”‚                    â”œâ”€ getSession()â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
  â”‚                    â”‚â†â”€ Valid? Return session         â”‚
  â”‚                    â”‚ or               â”‚               â”‚
  â”‚                    â”‚ Return null if expired          â”‚
  â”‚                    â”‚                  â”‚               â”‚
  â”‚                    â”œâ”€ onAuthStateChange()            â”‚
  â”‚                    â”‚ Listen for auth changes         â”‚
  â”‚                    â”‚                  â”‚               â”‚
  â”‚                    â”‚ User logs in     â”‚               â”‚
  â”‚                    â”œâ”€ Set loading=false              â”‚
  â”‚                    â”œâ”€ Save to localStorage           â”‚
  â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚               â”‚
  â”‚                    â”‚ (auto by Supabase)              â”‚
  â”‚                    â”‚                  â”‚               â”‚
  â”‚                    â”œâ”€ Fetch profile from DB          â”‚
  â”‚                    â”‚                  â”‚               â”‚
  â”‚                    â”‚ User logs out    â”‚               â”‚
  â”‚                    â”œâ”€ Clear localStorage             â”‚
  â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚               â”‚
  â”‚                    â”‚ Clear session state             â”‚
  â”‚                    â”‚ Redirect to /auth               â”‚
  â”‚
```

---

## Error Handling Flow

```
User Action
    â”‚
    â†“
Try Block
    â”‚
    â”œâ”€ Validation Error
    â”‚  â””â”€ Show field errors
    â”‚
    â”œâ”€ Network Error
    â”‚  â””â”€ Show: "Network error, please try again"
    â”‚
    â”œâ”€ Invalid Credentials
    â”‚  â””â”€ Show: "Invalid email or password"
    â”‚
    â”œâ”€ User Already Exists
    â”‚  â””â”€ Show: "Email already registered, try login"
    â”‚
    â”œâ”€ Database Error (RLS, etc.)
    â”‚  â””â”€ Show: "Database error, please try again"
    â”‚
    â””â”€ Unknown Error
       â””â”€ Show: "Unexpected error occurred"
    â”‚
    â†“
Toast Notification
(Success or Error)
```

---

## Security Architecture

```
Frontend (Client)              Backend (Supabase)         Database
â”‚                              â”‚                          â”‚
â”‚ Password Hashing             â”‚                          â”‚
â”‚ (handled by auth form)       â”‚                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                          â”‚
â”‚ â”‚ Input: password         â”‚  â”‚                          â”‚
â”‚ â”‚ Sent over HTTPS only    â”‚  â”‚                          â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                          â”‚
â”‚                â”‚              â”‚                          â”‚
â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ Password Hashing        â”‚
â”‚                â”‚              â”‚ (bcrypt)                â”‚
â”‚                â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
â”‚                â”‚              â”‚                          â”‚
â”‚ JWT Token      â”‚              â”‚                          â”‚
â”‚ (in localStorage)             â”‚ JWT Verification        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ (every request)         â”‚
â”‚ â”‚ token: eyJhbGc...       â”‚  â”‚                          â”‚
â”‚ â”‚ Sent in Authorization   â”‚  â”‚                          â”‚
â”‚ â”‚ header: Bearer <token>  â”‚  â”‚                          â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                          â”‚
â”‚                â”‚              â”‚                          â”‚
â”‚                â”œâ”€ Header â”€â”€â”€â”€â†’â”‚ Verify token signature  â”‚
â”‚                â”‚              â”‚ Check expiration        â”‚
â”‚                â”‚              â”‚ Check refresh needed    â”‚
â”‚                â”‚              â”‚                          â”‚
â”‚ RLS Policies   â”‚              â”‚ Row Level Security      â”‚
â”‚ (enforced by   â”‚              â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  backend)      â”‚              â”‚ â”‚ SELECT: Only own â”‚â”€â”€â”€â”€â”â”‚
â”‚                â”‚              â”‚ â”‚ UPDATE: Only own â”‚  â”‚ Database
â”‚                â”‚              â”‚ â”‚ INSERT: Own ID   â”‚  â”‚ Enforces
â”‚                â”‚              â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ RLS
â”‚                â”‚              â”‚                    â””â”€â”€â†’â”‚
â”‚                â”‚              â”‚                          â”‚
â”‚ HTTPS Only     â”‚              â”‚ Secure Endpoints       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ - HTTPS only           â”‚
â”‚ â”‚ All requests encrypted â”‚   â”‚ - No sensitive data    â”‚
â”‚ â”‚ No credentials in URL  â”‚   â”‚   in logs              â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ - Audit logs available â”‚
â”‚                â”‚              â”‚                        â”‚
â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                        â”‚
```

---

This architecture ensures:
âœ… Secure authentication
âœ… Scalable state management
âœ… Database-driven user data
âœ… Protected routes
âœ… Automatic session handling
âœ… Error recovery
